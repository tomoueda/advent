ex = """.|...\....
|.-.\.....
.....|-...
........|.
..........
.........\\
..../.\\\\..
.-.-/..|..
.|....-|.\\
..//.|...."""

ac = """\\..\\......-.....-..-./...........-......../.........................\\........../.........\\....../.........||..
|...../............|...\\.............\\.......\\............/..............-.../.........\\......\\\\....\\.........
...............|...................../..|.....\\.\\....|.........../......................../-......-.....\\-|...
..........-...................................-..\\....\\.......|.......|.-....|.../.../.......-.....\\-.........
|................-......................-............./.......\\.............\\................................\\
\\|.............../........................\\......|.|..............\\.........-...-....-.....\\...........-......
...............|..-............|..........|..|./-....|--.............-.../..........................\\......|..
.....-|.............................\\\\...........-.........||......|....-..-.......-..............-\\..........
...\\....\\......|.......\\|.......|...........-.......-.....\\......|..........|.........\\.......\\...............
...........\\.../........|.|............\\./.-\\...././...........\\...\\............../-......//|...\\.............
.............\\......-...../.................|....../.................................--.-..............\\......
..-..../....-............|................./................../......\\...../......-................./........|
..\\......\\............................\\..||....\\......................-..................../.|..|.../../\\...|.
..|.........\\...../................/...............\\......|..............\\.........-..\\.............../.....-.
....\\.................\\-......|.-..-..-..|...............-.-..\\.......|...................../.................
............../...........-..\\..|.................|......\\..|.......\\.-..-.../.......|....-..................\\
........../.....-......./....-...\\..................|....|../..|....../-.........|....../.........../..|\\|/...
...............................-......\\........................./............|..\\..................|.....|...|
....\\............|............/..................\\-.......\\...............|......................-.........|/.
-.......|...................\\..\\......|./............................//.|.....-.............|.........|...|...
............-...|.......-../\\......../..........|.-.........................-.................................
............../.....-......|./..............................\\.\\../\\..................-........................
...........................-...............................................|.......\\................|.......\\.
.-.........-...\\...........|......./...|........|.........|-|.................\\............/..................
....\\....-...|--...-.|............../..-........\\....................../\\.................-........-..........
......|..................-......\\|.......|........-....\\..........|.............-.............\\../....../.....
..............-.|.|.........-..........\\............./-.....\\............-..\\..\\..........|.......--..........
...........|.............-............|....-......\\......./.....||-...........|.|-........./....|..|...-...../
..../.......-|..........|.................................-......\\.................-...|...............-......
..|.|\\.........................../.....................|.......-........../......-\\..|...-..|....-..........-.
.../....\\........-.....|...-...-.|....../.........../......|.............\\...\\...../...........|.\\............
...............................\\......\\..-.\\......................\\................../....|\\......|..........-
....|.................--............//....|.....|.....-..........-.......................................|....
........-.........................\\....../...................|\\..........|........|.................-...-.....
............-...../.-..........-.............\\................/.......\\...........|.......|............/..-../
.\\.-............................/...././.........../............\\......-......................................
.....-....-.-|......./...................../......../....../..........-.................-..............-|.....
.....\\.-...-................../..-................|............././..........................-..../......\\....
......-....\\.........-.....|.........\\.............../...............|...../.|.........../................\\...
..|...\\.............-....../.......................|.......-.............|....................../|............
...........|..............-........./...............................\\................\\/...|-.............-....
......-......\\.....\\...........|..................................-......./............................\\......
....|...................../.....................................-/\\..............-.............\\\\.............
.....|....-.........-.-..../...................../......................................./|......./....../....
../...................-\\........../-..|..-..|........./................|...........-...............\\..........
..\\......./............\\....\\.......--...\\...............-..\\......-....................\\.|....|..........\\...
../........../.../|....|..|.............../..../.....-..-........................................\\|../........
...\\.................-...|..................|................//............\\.........\\........-/..............
..............\\/..........................|........||...............|.....|....\\....\\...../...-.|./.....\\.....
......\\....................|......................-.\\....-.......................-...../.|......./..../....\\..
............................-......................|./..-|....\\.-..|..........-.................\\...\\./|......
...................\\............................../...................|.....-./...../...........-........\\....
.....|.\\.......|..-.......\\.........................\\......../......../.../.|.............-........../........
................./-................................................-/......\\\\............-.........|..-.......
.............\\../.|.................................-.........|./.....................-........\\\\..\\.....-....
\\......../..............-/................\\.............|...|.................................../..\\..........
................./.......................\\....-......................../...\\.|..|.............................
/...........\\........|..........\\..........................\\.......................-..../.......|........../..
.......-..|......./................\\...................................|............../.\\..........\\....../...
......................./.|.................|........-|...............\\.|...-..................|...|......./...
-.|.......-./.................\\.....|.................................................|..\\.........\\..........
.|..-............/.|............/|-..........\\..................-..../...............\\......./../..\\.-........
........\\.-..\\\\.......\\...../..|......-.-..\\.....\\/................................/..........-.....\\|...../..
......./../../\\...................-........./...-....\\......\\........................\\............|...-.......
.-....|.....\\......\\.....|.|...../.........\\..\\....................|...........\\...|....................../...
.............../...../.........|....../....-....................|.....................\\.......|...|...........
....\\........../--|............../..............-.....|....\\....-.-................................./.....\\...
........|....\\.........../........|..|......|...................-..\\.../......../............\\.\\...../........
../.....|............................/......................./.......\\........\\.........../...........\\../.\\..
....|..\\...../.\\.........................................................................\\....................
/../.........................|||...........|...\\-.\\../......\\..-............-.../.....-.|.....................
.................|...............|...................................................................-./......
...|../.....................\\...................-......|/............................................\\.//../..
|./........-........./....\\...............|.........................|......|........|.\\....../............../.
........\\................|.|....................../............|......\\.......................|.......-.......
-...........|.........|/......|/....................-..................-.....|....|./.........................
.........\\..../..|..../...\\.....|........-.....-..|../.-.........................|............................
........|.-/.....|.......|......././.........................-...............\\......-.....|...................
.-...................|.......\\..........................................\\-../.................-............|..
..-..................../........../..........\\.........................-.................-..../-.........|....
........\\.........\\...........-|......../...-........-............\\\\/...........|..|....../.../............\\.\\
................................\\.....\\.-..............-................./...................|..............-.
................\\.|..\\/......\\.||................-.........|.....................\\.|................-.........
...................-................\\.............-|......./............|.-.............|..................|..
........|...|...-.\\.............\\..................|..-|.............\\........\\..-.....\\....................-.
..../........./\\.....-.......\\..........|..|...-........................................|.....................
.-...-.....-\\............-|../...\\.........../....-............./..........|................................./
......\\.....|.|\\...../...|..............\\...................-.................................\\............\\..
.........................|..-..............-...|........|......................-..............................
...../..\\................/...............-......\\.............|.......-.......|\\............./.\\..-...........
...../.\\.......\\.............\\.......................................-...\\.....//......\\......................
.....-..\\.../.-......|/../../........|...........-...\\|..........-.............../.......|..\\................/
............\\.....\\.../......\\..............|....../........\\./..-..\\....\\....-...............................
....................................-./................................\\.............../............/\\...../.-
..................-\\...-..\\....-......................-.....................-............-............./..\\...
.......\\..............\\......-......|...|/......................................................\\.|..|........
.........-|............./.............../..............-..................|...............\\................/..
..............\\.............\\-......................\\.../-|.................../...........|.............|.....
..............-......................../......--.................|-....\\..|............./.....|.....\\....-....
........|....../...................\\....\\.......-|.......\\..........|...................................\\.//..
.............|..........................-..........\\......................-.......-......./............./.....
..-.\\-................................../\\...|....-\\....|...............\\........./.........../....|..\\....../
....-....\\...-../.......|...../...\\........................-...................-.|........../../......|......\\
..................\\.|............................................./|..................--......................
....|../........./...-..-.........../.../......................\\....../................\\\\.............-.../...
..\\....|............|...................................../.....\\.....|....\\.|...................\\............
..............\\.......................\\.........-............|./..../--|.........................-...-........
......................../...............................................................................\\|/...
..............................................-..-...\\........................|-....................\\.........
........./..........-...../..........|................................\\................................/......"""

from tools import V
from collections import defaultdict
lines = ac.split('\n')
graph = defaultdict(lambda: None)
for y in range(len(lines)):
    for x in range(len(lines[0])):
        v = V(x, y)
        graph[v] = lines[y][x]

R = V(1, 0)
L = V(-1, 0)
U = V(0, -1)
D = V(0, 1)

def next_nodes(pos, d):
    next_pos = pos + d
    c = graph[next_pos]
    if c == None:
        return []
    if c == '|':
        if d == R or d == L:
            return [(next_pos, U), (next_pos, D)]
        return [(next_pos, d)]
    if c == '-':
        if d == U or d == D:
            return [(next_pos, L), (next_pos, R)]
        return [(next_pos, d)]
    if c == '\\':
        if d == R:
            return [(next_pos, D)]
        if d == L:
            return [(next_pos, U)]
        if d == D:
            return [(next_pos, R)]
        if d == U:
            return [(next_pos, L)]
    if c == '/':
        if d == R:
            return [(next_pos, U)]
        if d == L:
            return [(next_pos, D)]
        if d == D:
            return [(next_pos, L)]
        if d == U:
            return [(next_pos, R)]
    return [(next_pos, d)]



def print_graph(visited):
    s = ''
    for y in range(len(lines)):
        for x in range(len(lines[0])):
            if V(x, y) in visited:
                s += 'x'
            else:
                s += lines[y][x]
        s += '\n'

highest = 0

def score(node):
    visited = set()
    visited_2 = set()
    start = [node]
    while len(start) != 0:
        pos, d = start.pop()
        if (pos, d) not in visited_2:
            visited_2.add((pos, d))
            visited.add(pos)
            start += next_nodes(pos, d)
            # print_graph(visited)
    return len(visited)

starts = []
for x in range(len(lines[0])):
    starts.append((V(x, 0), D))
    starts.append((V(x, len(lines) - 1), U))
for y in range(len(lines)):
    starts.append((V(0, y), R))
    starts.append((V(len(lines[0]) - 1, y), L))

i = 0
for start in starts:
    print(i, len(starts))
    highest = max(highest, score(start))
    i += 1
print(highest)
